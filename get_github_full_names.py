# 根据 Github 账户的 following, stared 自动生成配置文件

from modules.github_user_following import get_user_following_main
from modules.github_user_fork_update import get_user_fork_update_main
from modules.github_user_star import get_user_star_main
import rtoml
from rtoml import dump
from pathlib import Path

# 读取配置项信息
CONFIG = rtoml.load(Path(__file__).parent / "config_debug.toml")
GITHUB_USER = CONFIG["github_user"]
GITHUB_TOKEN = CONFIG["github_token"]
USER_LIST = CONFIG["user_list"]
TOOLS_LIST = CONFIG["tools_list"]

if __name__ == "__main__":
    # 输入GitHub用户名和访问令牌
    # username = input("请输入GitHub用户名：")
    # access_token = input("请输入GitHub访问令牌：")

    user_list_new = get_user_following_main(GITHUB_USER, GITHUB_TOKEN)
    repos_fullnames_list = get_user_fork_update_main(GITHUB_USER, GITHUB_TOKEN)
    star_fullnames_list = get_user_star_main(GITHUB_USER, GITHUB_TOKEN)
    
    if user_list_new and repos_fullnames_list and star_fullnames_list:
        tools_new_list = repos_fullnames_list + star_fullnames_list
        
        # 追加结果到 USER_LIST 和 TOOLS_LIST，并去重
        USER_LIST.extend(user_list_new)
        USER_LIST = list(set(USER_LIST))
        TOOLS_LIST.extend(tools_new_list)
        TOOLS_LIST = list(set(TOOLS_LIST))

        print(f"USER_LIST: {USER_LIST}\n")
        print(f"TOOLS_LIST: {TOOLS_LIST}\n")
        # 更新配置项，并将结果保存到 config.toml 文件
        # CONFIG["user_list"] = USER_LIST
        # CONFIG["tools_list"] = TOOLS_LIST
        # dump(CONFIG, open(Path(__file__).parent / "config_debug.toml", "w", encoding="utf-8"))
